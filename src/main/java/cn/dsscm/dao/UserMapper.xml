<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dsscm.dao.UserMapper">
  <select id="selectList" resultType="UserInfo">
    SELECT *,user.name AS userName, role.name AS roleName FROM user
    JOIN identity ON user.identity = identity.id
    JOIN role ON identity.role = role.id
    <where>
      <if test="name != null">
        AND user.name LIKE CONCAT('%', #{name}, '%')
      </if>
      <if test="gender != null">
        AND gender = #{gender}
      </if>
      <if test="minAge != null">
        AND TIMESTAMPDIFF(YEAR, birthday, CURDATE()) &gt;= #{minAge}
      </if>
      <if test="maxAge != null">
        AND TIMESTAMPDIFF(YEAR, birthday, CURDATE()) &lt;= #{maxAge}
      </if>
      <if test="role != null">
        AND role = #{role}
      </if>
    </where>
  </select>

  <!-- selectById --> 

  <select id="selectById" resultType="UserInfo">
    SELECT *,user.name AS userName, role.name AS roleName FROM user
    JOIN identity ON user.identity = identity.id
    JOIN role ON identity.role = role.id
    WHERE user.id = #{id}
  </select>

  <!-- selectByAccount --> 

  <select id="selectByAccount" resultType="UserInfo">
    SELECT *,user.name AS userName, role.name AS roleName FROM user
    JOIN identity ON user.identity = identity.id
    JOIN role ON identity.role = role.id
    WHERE account = #{account}
  </select>
</mapper>